{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "D&D 5e Character Input",
  "description": "A schema for importing a Dungeons & Dragons 5th Edition character sheet. It contains only the fields that need to be provided as input. Calculated values like final ability scores, proficiency bonus, and max HP are excluded.",
  "type": "object",
  "properties": {
    "name": {
      "type": "string",
      "description": "The character's name.",
      "errorMessage": "Character name must be a non-empty string."
    },
    "title": {
      "type": "string",
      "description": "An optional title or epithet for the character."
    },
    "class": {
      "type": "string",
      "description": "The character's class (selected from rules.js).",
      "errorMessage": "Class must be a non-empty string."
    },
    "level": {
      "type": "integer",
      "description": "The character's level.",
      "minimum": 1,
      "maximum": 20,
      "default": 1,
      "errorMessage": "Level must be a number between 1 and 20."
    },
    "species": {
      "type": "string",
      "description": "The character's species (selected from rules.js).",
      "errorMessage": "Species must be a non-empty string."
    },
    "background": {
      "type": "string",
      "description": "The character's background (selected from rules.js).",
      "errorMessage": "Background must be a non-empty string."
    },
    "pointBuyBaseScores": {
      "type": "object",
      "description": "The character's six base ability scores (8-15) used for point buy calculation.",
      "properties": {
        "str": { "type": "integer", "minimum": 8, "maximum": 15, "errorMessage": "Strength score must be between 8 and 15." },
        "dex": { "type": "integer", "minimum": 8, "maximum": 15, "errorMessage": "Dexterity score must be between 8 and 15." },
        "con": { "type": "integer", "minimum": 8, "maximum": 15, "errorMessage": "Constitution score must be between 8 and 15." },
        "int": { "type": "integer", "minimum": 8, "maximum": 15, "errorMessage": "Intelligence score must be between 8 and 15." },
        "wis": { "type": "integer", "minimum": 8, "maximum": 15, "errorMessage": "Wisdom score must be between 8 and 15." },
        "cha": { "type": "integer", "minimum": 8, "maximum": 15, "errorMessage": "Charisma score must be between 8 and 15." }
      },
      "required": ["str", "dex", "con", "int", "wis", "cha"],
      "errorMessage": "Point buy base scores must be an object with str, dex, con, int, wis, cha properties."
    },
    "backgroundBonusSelections": {
      "type": "object",
      "description": "The ability scores selected for the background's +2 and +1 bonuses.",
      "properties": {
        "plusTwo": { "type": ["string", "null"], "enum": ["str", "dex", "con", "int", "wis", "cha", null] },
        "plusOne": { "type": ["string", "null"], "enum": ["str", "dex", "con", "int", "wis", "cha", null] }
      },
      "required": ["plusTwo", "plusOne"],
      "errorMessage": "Background bonus selections are required."
    },
    "proficiencies": {
      "type": "object",
      "description": "Skill and saving throw proficiencies.",
      "properties": {
        "skills": {
          "type": "array",
          "description": "List of skill names (lowercase, no spaces) the character is proficient in.",
          "items": { "type": "string" }
        },
        "savingThrows": {
          "type": "array",
          "description": "List of ability score abbreviations (lowercase) for saving throw proficiencies.",
          "items": { "type": "string", "enum": ["str", "dex", "con", "int", "wis", "cha"] }
        }
      },
      "required": ["skills", "savingThrows"]
    },
    "combat": {
      "type": "object",
      "description": "Combat-related statistics.",
      "properties": {
        "ac": {
          "type": "integer",
          "description": "Armor Class."
        },
        "speed": {
          "type": "string",
          "description": "Movement speed (e.g., '30ft')."
        }
      },
      "required": ["ac", "speed"]
    },
    "attacks": {
      "type": "array",
      "description": "List of character attacks.",
      "items": {
        "type": "object",
        "properties": {
          "name": { "type": "string" },
          "atkStat": { "type": "string", "enum": ["str", "dex", "con", "int", "wis", "cha"] },
          "dmgDie": { "type": "string", "pattern": "^\\d+d\\d+$", "errorMessage": "Damage die must be in the format 'XdY' (e.g., '1d8')." },
          "dmgStat": { "type": "string", "enum": ["str", "dex", "con", "int", "wis", "cha"] },
          "dmgBonus": { "type": "integer", "default": 0 },
          "type": { "type": "string", "description": "Damage type." },
          "notes": { "type": "string" },
          "weaponMastery": { "type": "string" }
        },
        "required": ["name", "atkStat", "dmgDie", "dmgStat", "type"],
        "errorMessage": {
            "required": {
                "name": "Attack name is required.",
                "atkStat": "Attack stat is required.",
                "dmgDie": "Damage die is required.",
                "dmgStat": "Damage stat is required.",
                "type": "Damage type is required."
            }
        }
      }
    },
    "features": {
      "type": "array",
      "description": "List of character features and traits. Features from class/species/background should be included here on import.",
      "items": {
        "type": "object",
        "properties": {
          "title": { "type": "string" },
          "desc": { "type": "string" },
          "key": { "type": "boolean", "description": "Display on front page.", "default": false },
          "uses": {
            "type": ["object", "null"],
            "properties": {
              "total": { "type": "integer" },
              "per": { "type": "string" }
            },
            "required": ["total", "per"]
          },
          "casterType": {
            "type": ["string", "null"],
            "description": "Specifies spellcasting progression if this feature grants it.",
            "enum": ["full", "half", "third", "pact", "none", null]
          }
        },
        "required": ["title", "desc"]
      }
    },
    "equipment": {
      "type": "string",
      "description": "Character's equipment list."
    },
    "personality": {
      "type": "object",
      "description": "Personality details.",
      "properties": {
        "traits": { "type": "string" },
        "ideal": { "type": "string" },
        "bond": { "type": "string" },
        "flaw": { "type": "string" }
      },
      "required": ["traits", "ideal", "bond", "flaw"]
    },
    "spellcasting": {
      "type": ["object", "null"],
      "description": "Spellcasting details, populated if a feature grants casting.",
      "properties": {
        "ability": {
          "type": "string",
          "enum": ["str", "dex", "con", "int", "wis", "cha"],
          "description": "Spellcasting ability modifier key."
        }
      },
      "required": ["ability"]
    },
    "spells": {
      "type": "array",
      "description": "List of known/prepared spells.",
      "items": {
        "type": "object",
        "properties": {
          "name": { "type": "string" },
          "level": { "type": "integer", "minimum": 0, "maximum": 9 },
          "desc": { "type": "string" }
        },
        "required": ["name", "level", "desc"]
      }
    }
  },
  "required": [
    "name",
    "class",
    "level",
    "species",
    "background",
    "pointBuyBaseScores",
    "backgroundBonusSelections",
    "personality"
  ],
  "errorMessage": {
      "required": {
          "name": "Character name is required.",
          "class": "Class is required.",
          "level": "Level is required.",
          "species": "Species is required.",
          "background": "Background is required.",
          "pointBuyBaseScores": "Point buy base scores are required.",
          "backgroundBonusSelections": "Background bonus selections are required.",
          "personality": "Personality traits, ideal, bond, and flaw are required."
      }
  }
}
